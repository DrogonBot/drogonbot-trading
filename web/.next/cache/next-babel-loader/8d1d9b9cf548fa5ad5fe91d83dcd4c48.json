{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport axios from 'axios';\nimport Router from 'next/router';\nimport { appEnv, ENV, EnvironmentTypes } from '../constants/Env.constant';\nimport { TS } from './LanguageHelper';\nexport var APIHelper = function APIHelper() {\n  _classCallCheck(this, APIHelper);\n};\n\n_defineProperty(APIHelper, \"request\", function _callee(method, url, data) {\n  var useAuth,\n      customHeaders,\n      onTimeoutCallback,\n      timeout,\n      AUTH_HEADERS,\n      token,\n      GUEST_HEADERS,\n      abort,\n      timeoutCallback,\n      response,\n      _args = arguments;\n  return _regeneratorRuntime.async(function _callee$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          useAuth = _args.length > 3 && _args[3] !== undefined ? _args[3] : true;\n          customHeaders = _args.length > 4 && _args[4] !== undefined ? _args[4] : {};\n          onTimeoutCallback = _args.length > 5 && _args[5] !== undefined ? _args[5] : function () {\n            return null;\n          };\n          timeout = _args.length > 6 && _args[6] !== undefined ? _args[6] : 5000;\n          _context.prev = 4;\n\n          if (!useAuth) {\n            _context.next = 10;\n            break;\n          }\n\n          _context.next = 8;\n          return _regeneratorRuntime.awrap(window.localStorage.getItem(\"token\"));\n\n        case 8:\n          token = _context.sent;\n          AUTH_HEADERS = {\n            Authorization: \"Bearer \".concat(token),\n            \"Content-type\": \"application/json\"\n          };\n\n        case 10:\n          GUEST_HEADERS = {\n            \"Content-type\": \"application/json\"\n          }; // prepare connection timeout callback\n\n          abort = axios.CancelToken.source();\n          timeoutCallback = setTimeout(function () {\n            abort.cancel(\"Timeout of \".concat(timeout, \"ms.\"));\n\n            if (onTimeoutCallback() !== null) {\n              onTimeoutCallback();\n            } else {\n              console.log(\"request timeout\");\n              alert(TS.string(\"global\", \"requestTimeoutTitle\"));\n              Router.push(\"/login\");\n            }\n          }, timeout);\n\n          if (ENV === EnvironmentTypes.Development) {\n            console.log(\"Request to: \".concat(appEnv.serverUrl).concat(url));\n          } // execute request\n\n\n          _context.next = 16;\n          return _regeneratorRuntime.awrap(axios({\n            method: method,\n            url: \"\".concat(appEnv.serverUrl).concat(url),\n            data: data,\n            cancelToken: abort.token,\n            validateStatus: function validateStatus(status) {\n              return status >= 200 && status <= 500; // default\n            },\n            headers: useAuth ? _objectSpread({}, AUTH_HEADERS, {}, customHeaders) : _objectSpread({}, GUEST_HEADERS, {}, customHeaders)\n          }));\n\n        case 16:\n          response = _context.sent;\n\n          // If user is not authenticated...\n          // 401 = Unauthorized status\n          if (response.status === 401) {\n            console.log(\"User is not authenticated. Redirecting to Login...\"); // clear current redux store\n            // persistor.purge();\n\n            console.log(\"authentication error\");\n            alert(TS.string(\"account\", \"loginUserNotAuthenticated\"));\n            Router.push(\"/login\"); // NavigationHelper.navigate(\"Auth\", null);\n          }\n\n          clearTimeout(timeoutCallback);\n          return _context.abrupt(\"return\", response);\n\n        case 22:\n          _context.prev = 22;\n          _context.t0 = _context[\"catch\"](4);\n          console.log(_context.t0);\n\n        case 25:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, null, null, [[4, 22]], Promise);\n});","map":{"version":3,"sources":["/usr/src/app/src/helpers/APIHelper.ts"],"names":["axios","Router","appEnv","ENV","EnvironmentTypes","TS","APIHelper","method","url","data","useAuth","customHeaders","onTimeoutCallback","timeout","window","localStorage","getItem","token","AUTH_HEADERS","Authorization","GUEST_HEADERS","abort","CancelToken","source","timeoutCallback","setTimeout","cancel","console","log","alert","string","push","Development","serverUrl","cancelToken","validateStatus","status","headers","response","clearTimeout"],"mappings":";;;;;;;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,MAAP,MAAmB,aAAnB;AAEA,SAASC,MAAT,EAAiBC,GAAjB,EAAsBC,gBAAtB,QAA8C,2BAA9C;AACA,SAASC,EAAT,QAAmB,kBAAnB;AAEA,WAAaC,SAAb;AAAA;AAAA;;gBAAaA,S,aACa,iBACtBC,MADsB,EAEtBC,GAFsB,EAGtBC,IAHsB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAItBC,UAAAA,OAJsB,2DAIZ,IAJY;AAKtBC,UAAAA,aALsB,2DAKE,EALF;AAMtBC,UAAAA,iBANsB,2DAMF;AAAA,mBAAM,IAAN;AAAA,WANE;AAOtBC,UAAAA,OAPsB,2DAOZ,IAPY;AAAA;;AAAA,eAWhBH,OAXgB;AAAA;AAAA;AAAA;;AAAA;AAAA,2CAYEI,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B,OAA5B,CAZF;;AAAA;AAYZC,UAAAA,KAZY;AAclBC,UAAAA,YAAY,GAAG;AACbC,YAAAA,aAAa,mBAAYF,KAAZ,CADA;AAEb,4BAAgB;AAFH,WAAf;;AAdkB;AAoBdG,UAAAA,aApBc,GAoBE;AACpB,4BAAgB;AADI,WApBF,EAwBpB;;AACMC,UAAAA,KAzBc,GAyBNrB,KAAK,CAACsB,WAAN,CAAkBC,MAAlB,EAzBM;AA2BdC,UAAAA,eA3Bc,GA2BIC,UAAU,CAAC,YAAM;AACvCJ,YAAAA,KAAK,CAACK,MAAN,sBAA2Bb,OAA3B;;AACA,gBAAID,iBAAiB,OAAO,IAA5B,EAAkC;AAChCA,cAAAA,iBAAiB;AAClB,aAFD,MAEO;AACLe,cAAAA,OAAO,CAACC,GAAR,CAAY,iBAAZ;AACAC,cAAAA,KAAK,CAACxB,EAAE,CAACyB,MAAH,CAAU,QAAV,EAAoB,qBAApB,CAAD,CAAL;AACA7B,cAAAA,MAAM,CAAC8B,IAAP,CAAY,QAAZ;AACD;AACF,WATiC,EAS/BlB,OAT+B,CA3Bd;;AAsCpB,cAAIV,GAAG,KAAKC,gBAAgB,CAAC4B,WAA7B,EAA0C;AACxCL,YAAAA,OAAO,CAACC,GAAR,uBAA2B1B,MAAM,CAAC+B,SAAlC,SAA8CzB,GAA9C;AACD,WAxCmB,CA0CpB;;;AA1CoB;AAAA,2CA8CGR,KAAK,CAAC;AAC3BO,YAAAA,MAAM,EAANA,MAD2B;AAE3BC,YAAAA,GAAG,YAAKN,MAAM,CAAC+B,SAAZ,SAAwBzB,GAAxB,CAFwB;AAG3BC,YAAAA,IAAI,EAAJA,IAH2B;AAI3ByB,YAAAA,WAAW,EAAEb,KAAK,CAACJ,KAJQ;AAK3BkB,YAAAA,cAL2B,0BAKZC,MALY,EAKJ;AACrB,qBAAOA,MAAM,IAAI,GAAV,IAAiBA,MAAM,IAAI,GAAlC,CADqB,CACkB;AACxC,aAP0B;AAQ3BC,YAAAA,OAAO,EAAE3B,OAAO,qBACPQ,YADO,MACUP,aADV,sBAEPS,aAFO,MAEWT,aAFX;AARW,WAAD,CA9CR;;AAAA;AA8Cd2B,UAAAA,QA9Cc;;AA2DpB;AACA;AACA,cAAIA,QAAQ,CAACF,MAAT,KAAoB,GAAxB,EAA6B;AAC3BT,YAAAA,OAAO,CAACC,GAAR,CAAY,oDAAZ,EAD2B,CAE3B;AACA;;AAEAD,YAAAA,OAAO,CAACC,GAAR,CAAY,sBAAZ;AACAC,YAAAA,KAAK,CAACxB,EAAE,CAACyB,MAAH,CAAU,SAAV,EAAqB,2BAArB,CAAD,CAAL;AACA7B,YAAAA,MAAM,CAAC8B,IAAP,CAAY,QAAZ,EAP2B,CAQ3B;AACD;;AAEDQ,UAAAA,YAAY,CAACf,eAAD,CAAZ;AAxEoB,2CA0Ebc,QA1Ea;;AAAA;AAAA;AAAA;AA4EpBX,UAAAA,OAAO,CAACC,GAAR;;AA5EoB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,C","sourcesContent":["import axios from 'axios';\nimport Router from 'next/router';\n\nimport { appEnv, ENV, EnvironmentTypes } from '../constants/Env.constant';\nimport { TS } from './LanguageHelper';\n\nexport class APIHelper {\n  public static request = async (\n    method: any,\n    url: string,\n    data: object,\n    useAuth = true,\n    customHeaders: object = {},\n    onTimeoutCallback = () => null,\n    timeout = 5000\n  ) => {\n    let AUTH_HEADERS;\n    try {\n      if (useAuth) {\n        const token = await window.localStorage.getItem(\"token\");\n\n        AUTH_HEADERS = {\n          Authorization: `Bearer ${token}`,\n          \"Content-type\": \"application/json\",\n        };\n      }\n\n      const GUEST_HEADERS = {\n        \"Content-type\": \"application/json\",\n      };\n\n      // prepare connection timeout callback\n      const abort = axios.CancelToken.source();\n\n      const timeoutCallback = setTimeout(() => {\n        abort.cancel(`Timeout of ${timeout}ms.`);\n        if (onTimeoutCallback() !== null) {\n          onTimeoutCallback();\n        } else {\n          console.log(\"request timeout\");\n          alert(TS.string(\"global\", \"requestTimeoutTitle\"));\n          Router.push(\"/login\");\n        }\n      }, timeout);\n\n      if (ENV === EnvironmentTypes.Development) {\n        console.log(`Request to: ${appEnv.serverUrl}${url}`);\n      }\n\n      // execute request\n\n\n\n      const response = await axios({\n        method,\n        url: `${appEnv.serverUrl}${url}`,\n        data,\n        cancelToken: abort.token,\n        validateStatus(status) {\n          return status >= 200 && status <= 500; // default\n        },\n        headers: useAuth\n          ? { ...AUTH_HEADERS, ...customHeaders }\n          : { ...GUEST_HEADERS, ...customHeaders },\n      });\n\n      // If user is not authenticated...\n      // 401 = Unauthorized status\n      if (response.status === 401) {\n        console.log(\"User is not authenticated. Redirecting to Login...\");\n        // clear current redux store\n        // persistor.purge();\n\n        console.log(\"authentication error\");\n        alert(TS.string(\"account\", \"loginUserNotAuthenticated\"));\n        Router.push(\"/login\");\n        // NavigationHelper.navigate(\"Auth\", null);\n      }\n\n      clearTimeout(timeoutCallback);\n\n      return response;\n    } catch (error) {\n      console.log(error);\n    }\n  };\n}\n"]},"metadata":{},"sourceType":"module"}